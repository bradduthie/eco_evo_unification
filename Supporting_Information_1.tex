% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
% definitions for citeproc citations
\NewDocumentCommand\citeproctext{}{}
\NewDocumentCommand\citeproc{mm}{%
  \begingroup\def\citeproctext{#2}\cite{#1}\endgroup}
\makeatletter
 % allow citations to break across lines
 \let\@cite@ofmt\@firstofone
 % avoid brackets around text for \cite:
 \def\@biblabel#1{}
 \def\@cite#1#2{{#1\if@tempswa , #2\fi}}
\makeatother
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newenvironment{CSLReferences}[2] % #1 hanging-indent, #2 entry-spacing
 {\begin{list}{}{%
  \setlength{\itemindent}{0pt}
  \setlength{\leftmargin}{0pt}
  \setlength{\parsep}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
   \setlength{\leftmargin}{\cslhangindent}
   \setlength{\itemindent}{-1\cslhangindent}
  \fi
  % set entry spacing
  \setlength{\itemsep}{#2\baselineskip}}}
 {\end{list}}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{\hfill\break\parbox[t]{\linewidth}{\strut\ignorespaces#1\strut}}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}
\usepackage{fancyhdr}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Foundations of community ecology: Supporting Information 1},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Foundations of community ecology: Supporting Information 1}
\author{A. Bradley Duthie\(^{1,a,*}\) and Victor J. Luque\(^{2,a}\)}
\date{{[}1{]} Department of Biological and Environmental Sciences,
University of Stirling, Stirling, Scotland {[}2{]} Department of
Philosophy, University of Valencia, Valencia, Spain {[}*{]}
Corresponding author:
\href{mailto:alexander.duthie@stir.ac.uk}{\nolinkurl{alexander.duthie@stir.ac.uk}}
{[}a{]} Equal contribution}

\begin{document}
\maketitle

We start with the fundamental equation that provides a complete
description of eco-evolutionary change in any system,

\[\Omega = \sum_{i=1}^{N} \left(\beta_{i} - \delta_{i} + 1 \right)\left(z_{i} + \Delta z_{i} \right).
\tag{1}
\]

In the main text, we derived both the Price equation and the birth-death
model from the above. Here we integrate interactions between individuals
and demonstrate how this affects population and evolutionary dynamics
simultaneously. We can do this in a way that clarifies model assumptions
by allowing an individual \(j\) to modulate the birth or death of the
focal individual \(i\). We will first illustrate how this leads to two
separate discrete time models of density depedent population growth,
then illustrate how the same starting point can be used to recover
Hamilton's rule in evolutionary ecology.

\section{Density-dependent population
growth}\label{density-dependent-population-growth}

There are two potential ways to model the incorporation of density
dependence into population growth. First note that here we set
\(\Omega = N_{t+1}\), and \(z_{i} = 1\) and \(\Delta z_{i} = 0\) for all
individuals. We can define \(r_{i} = \beta_{i} - \delta_{i}\) as an
individual growth rate for \(i\) (\citeproc{ref-Lion2018}{Lion 2018};
\citeproc{ref-Lion2023}{Lion, Sasaki, and Boots 2023}). In this case,

\[N_{t+1} = \sum_{i=1}^{N_{t}}\left(r_{i} + 1\right)
\tag{S1}
\]

Mathematically, the most general approach here would be to define
individual growth as a function of the entire system \(\mathbf{E}\),
\(r_{i}(\mathbf{E})\), where \(\mathbf{E}\) is a vector with elements
including any parameters potentially relevant to \(r_{i}\). Taking this
approach would recover a version of eqn 2 in Lion
(\citeproc{ref-Lion2018}{2018}) and permit any relationship between the
system and a focal individual's growth. Focusing on effects of other
individuals (\(j\)) and assuming that the effects of these individuals
are additive, let \(a_{ij|\cdot}\) be the effect of individual \(j\) on
the growth rate attributable to \(i\) conditioned on all other
individuals within the population such that
\(r_{i}\left(1 + \sum_{i = j}^{N}a_{ij|\cdot} \right)\) defines the
realised growth rate of \(i\),

\[N_{t+1} = \sum_{i=1}^{N_{t}}\left(r_{i}\left(1 - \sum_{i = j}^{N_{t}}a_{ij|\cdot} \right) + 1\right).
\tag{S2}
\]

Assuming that individual effects of \(j\) on \(i\) are also independent,
we can remove the condition,

\[N_{t+1} = \sum_{i=1}^{N_{t}}\left(r_{i}\left(1 - \sum_{i = j}^{N_{t}}a_{ij} \right) + 1\right).\]

Further assuming that all individuals have the same per capita effect
such that \(\alpha = a_{ij}\) for any \(i\) and \(j\) pair (as might be
reasonable given resource competition in a well-mixed population),

\[N_{t+1} = \sum_{i=1}^{N_{t}}\left(r_{i}\left(1 - \alpha N_{t} \right) + 1\right).\]

If \(r_{i}\) values are identical,

\[N_{t+1} = N_{t} + r N_{t}\left(1 - \alpha N_{t} \right).
\tag{S3}
\]

Equation S3 therefore recovers a classic version of a discrete time
logistic growth by making assumptions from an exact model of
eco-evolutionary change. An alternative approach would be to define
model the effects \(e_{ij}\) an individual \(j\) on the fitness of \(i\)
(\(w_{i}\)), thereby replacing eqn S1 with
\(N_{t+1} = \sum_{i=1}^{N_{t}}w_{i}\) and replacing eqn S2 with,

\[N_{t+1} = \sum_{i=1}^{N_{t}}w_{i}\left(1 - \sum_{i = j}^{N_{t}}e_{ij|\cdot} \right).
\]

By making the same assumptions of additivity, independence, and
identical effects such that \(e_{ij} = \epsilon\) for all \(j\) on
\(i\), and assuming fitness is equal (\(w_{i} = w\)), we can derive,

\[N_{t+1} = wN_{t}(1 - \epsilon N_{t}).
\tag{S4}
\]

\section{Multi-level selection}\label{multi-level-selection}

We can recover multi-level selection from our eqn 1. Here we derive the
original form of the multilevel Price (\citeproc{ref-Price1972}{1972})
equation as appears in eqn 3.1 of Lehtonen
(\citeproc{ref-Lehtonen2020a}{2020}). Individuals \(i\) belong to one of
\(K\) total groups where \(j\) indexes \(K\) and groups do not overlap.
The size of group \(j\) is denoted as \(N_{j}\). Equation S5 below uses
summations to partition how individuals within each group contribute to
\(\Omega\),

\[\Omega = \sum_{j=1}^{K}\sum_{i=1}^{N_{j}}\left(\beta_{j,i} - \delta_{j,i} + 1 \right)\left(z_{j, i} + \Delta z_{j, i}\right).
\tag{S5}
\]

In S5, indices \(\beta_{j, i}\), \(\delta_{j, i}\), and \(z_{j, i}\)
identify individual \(i\) in group \(j\). For simplicity, we set
\(w_{j, i} = \beta_{j, i} - \delta_{j, i} + 1\) and let
\(\Delta z_{j, i} = 0\) (i.e., no transmission bias),

\[\Omega = \sum_{j=1}^{K}\sum_{i=1}^{N_{j}}w_{j,i}z_{j, i}.\]

For ease of presentation, with no loss of generality, we assume all
group sizes are equal with a group size of \(N_{j} = n\) for all \(j\).
If group sizes differ, then weighted expectations and covariances are
instead needed (\citeproc{ref-Lehtonen2020a}{Lehtonen 2020}). Given
equal group sizes, the total number of individuals (\(N\)) equals
\(K \times n\), and,

\[\frac{\Omega}{K n} = \left(\frac{1}{K}\right)\left(\frac{1}{n}\right)\sum_{j=1}^{K}\sum_{i=1}^{n}w_{j,i}z_{j, i}.\]

Rearranging,

\[\frac{\Omega}{K n} = \frac{1}{K}\sum_{j=1}^{K}\frac{1}{n}\sum_{i=1}^{n}w_{j,i}z_{j, i}.\]

The inner summation can be rewritten as an expectation,

\[\frac{\Omega}{K n} = \frac{1}{K}\sum_{j=1}^{K}E\left(w_{j,i} z_{j,i}\right).\]

As in the main text, we note
\(\mathrm{E}(XY) = \mathrm{Cov}(X,Y) + \mathrm{E}(X)\mathrm{E}(Y)\),
therefore,

\[\frac{\Omega}{K n} = \frac{1}{K}\sum_{j=1}^{K}Cov\left(w_{j,i}, z_{j,i}\right) + E\left(w_{j,i}\right)E\left(z_{j,i}\right).\]

We can separate the summation for each term,

\[\frac{\Omega}{K n} = \frac{1}{K}\sum_{j=1}^{K}Cov\left(w_{j,i}, z_{j,i}\right) + \frac{1}{K}\sum_{j=1}^{K}E\left(w_{j,i}\right)E\left(z_{j,i}\right).\]

Using the notation \(\bar{w}_{j} = E(w_{j,i})\) and
\(\bar{z}_{j} = E(z_{j,i})\),

\[\frac{\Omega}{K n} = \frac{1}{K}\sum_{j=1}^{K}Cov\left(w_{j,i}, z_{j,i}\right) + E\left(\bar{w}_{j} \bar{z}_{j} \right).\]

Similarly, defining \(Cov_{j}(w_{j}, z_{j})\) as the covariance between
\(w_{j,i}\) and \(z_{j, i}\) for group \(j\),

\[\frac{\Omega}{K n} = E\left(Cov_{j}\left(w_{j}, z_{j}\right)\right) + E\left(\bar{w}_{j} \bar{z}_{j} \right).\]

We can rearrange the second term on the right-hand side
(\(\bar{\bar{w}}\) indicates grand mean over all groups),

\[\frac{\Omega}{K n} = E\left(Cov_{j}\left(w_{j}, z_{j}\right)\right) +  Cov\left(\bar{w}_{j}, \bar{z}_{j} \right) + \bar{\bar{w}}\bar{\bar{z}}.\]

We can set \(\Omega = Kn\bar{\bar{w}}\bar{\bar{z'}}\), so,

\[\frac{Kn\bar{\bar{w}}\bar{\bar{z'}}}{K n} - \bar{\bar{w}}\bar{\bar{z}} = E\left(Cov_{j}\left(w_{j}, z_{j}\right)\right) +  Cov\left(\bar{w}_{j}, \bar{z}_{j} \right).\]

Because \(\Delta \bar{\bar{z}} = \bar{\bar{z'}} - \bar{\bar{z}}\),

\[\bar{\bar{w}}\Delta = Cov\left(\bar{w}_{j}, \bar{z}_{j} \right) + E\left(Cov_{j}\left(w_{j}, z_{j}\right)\right).\]

This recovers the multilevel Price (\citeproc{ref-Price1972}{1972})
equation (\citeproc{ref-Lehtonen2020a}{Lehtonen 2020}) from a starting
point of eco-evolutionary change in different groups.

\section*{References}\label{references}
\addcontentsline{toc}{section}{References}

\phantomsection\label{refs}
\begin{CSLReferences}{1}{0}
\bibitem[\citeproctext]{ref-Lehtonen2020a}
Lehtonen, Jussi. 2020. {``The Price Equation and the Unity of Social
Evolution Theory.''} \emph{Philosophical Transactions of the Royal
Society B: Biological Sciences} 375: 20190362.
\url{https://doi.org/10.1098/rstb.2019.0362}.

\bibitem[\citeproctext]{ref-Lion2018}
Lion, Sébastien. 2018. {``{Theoretical approaches in evolutionary
ecology: environmental feedback as a unifying perspective}.''}
\emph{American Naturalist} 191 (1).
\url{https://doi.org/10.1086/694865}.

\bibitem[\citeproctext]{ref-Lion2023}
Lion, Sébastien, Akira Sasaki, and Mike Boots. 2023. {``Extending
Eco-Evolutionary Theory with Oligomorphic Dynamics.''} \emph{Ecology
Letters} 26 (September): S22--46.
\url{https://doi.org/10.1111/ele.14183}.

\bibitem[\citeproctext]{ref-Price1972}
Price, George R. 1972. {``{Extension of covariance selection
mathematics}.''} \emph{Annals of Human Genetics} 35 (4): 485--90.
\url{https://doi.org/10.1111/j.1469-1809.1957.tb01874.x}.

\end{CSLReferences}

\end{document}
